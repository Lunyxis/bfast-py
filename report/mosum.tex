\documentclass[main.tex]{subfiles}

\begin{document}
\chapter{OLS-MOSUM Test}
\label{chap:mosum}
Tests from the generalized fluctuation test framework \cite{kuan_hornik}
is one of the most important classes of tests on structural change. This class
of tests include, in particular, Moving Sum (MOSUM) test, which is the topic of this chapter.
In the paper from 2003 \cite{strucchange}, Zeileis et al. describe the
underlying theory and usage of the \texttt{strucchange} package for the
R programming language that includes multiple tools for detection of structural
changes in linear regression relationships.

\section{The Model}
\label{sec:model}
In \texttt{strucchange} \cite{strucchange}, a standard linear regression model is considered:
\[
y_{i}=x_{i}^{\top} \beta_{i}+u_{i} \quad(i=1, \ldots, n)
\]
where:
\begin{itemize}
\item $i$ is the observation number
\item $x_i = (1,x_{i2}, x_{i3}, ..., x_{ik})^T \in \mathbb{R}^k$, given to us
\item $y_i \in \mathbb{R}$, also given
\item $\beta_i \in \mathbb{R}^{k} $ is the regression coefficient vector, that
  we wish to estimate using linear regression
\item $u_i \in \mathbb{R}$ is the residual term that is independently and identically
  distributed with mean $\mu = 0$ and variance $\sigma^2$. This is the
  difference between the prediction (using $\beta_i$) and the actual observation $y_i$.
\end{itemize}
We can then test for structural change by testing the null hypothesis:
\[
H_0:\quad \beta_i = \beta_0 \quad(i=1, \ldots, n)
\]
which states that there is no structural change present in the time series.
While the alternative is that the coefficient vector $\beta$ varies over time -
hence is are one or more breakpoints. \\\\
Let $\hat{\beta}^{(i)}$ be the ordinary least squares (OLS) estimate of the
regression coefficients based on all the observations up to $i$.
Therefore, it follows that $\hat{\beta}^{(n)}$ is the common OLS estimate in the regression model. \\\\
Let the OLS residuals be defined as:

\begin{equation} \label{eq:residuals}
\hat{u}_i = y_i - x^T\hat{\beta}^{(n)}
\end{equation}
the variance estimate would then be:
\begin{equation} \label{eq:sigma}
\hat{\sigma}^{2}=\frac{1}{n-k} \sum_{i=1}^{n} \hat{u}_{i}^{2}
\end{equation}

\section{Empirical Fluctuation Process (OLS-MOSUM)}
\label{sec:empirical_fluctuation}
It is possible to detect structural change by analyzing moving sum of residuals
\cite{strucchange}. The resulting empirical fluctuation process consists of a
sum of a fixed number of residuals in a data interval, which size is determined
by the value of the parameter $h \in (0,1)$ (bandwidth). \\\\
The OLS-based MOSUM process is given by \cite{mosum_tests}:

\begin{equation}\label{eq:mosum_og}
M(t)=\frac{1}{\hat{\sigma} \sqrt{n}}
\left(\sum_{i=\floor{N_{n} t}+1}^{\left\lfloor N_{n} t\right\rfloor+\lfloor
  n h\rfloor} \hat{u}_{i}\right) \quad(0 \leq t \leq 1-h)
\end{equation}
where $N_{n}=(n-\floor{n h}) /(1-h)$ and $\floor{n h}$ is the size of the
window. \\\\
This expression can be simplified by first re-scaling the
expression s.t. $0 \leq t \leq 1$:
\begin{equation}
  M(t) =
  \frac{1}{\hat{\sigma} \sqrt{n}}
  \left(\sum_{i=\floor{t(n - \floor{nh})} + 1}^{\floor{t(n - \floor{nh})} + \floor{nh}}\right)
  \quad(0 \leq t \leq 1)
\end{equation}
Then, we can apply a second re-write, s.t.
$t \in \mathbb{Z}^+ \wedge t \leq (n - \floor{nh} + 1)$:
\begin{equation} \label{eq:mosum}
  M(t) =
  \frac{1}{\hat{\sigma} \sqrt{n}}
  \left(\sum_{i=t}^{t + \floor{nh}}\right)
  \quad(t \in \mathbb{Z}^+ \wedge t \leq (n - \floor{nh} + 1))
\end{equation}


\section{Significance Testing}
\label{sec:significance_testing}
A key observation is that if a structural change takes place at $t_0$, the
OLS-MOSUM path would also have a strong shift at $t_0$.
We reject the null hypothesis of there being no structural change, when the fluctuation of
the OLS-MOSUM process becomes too large.\\\\
In practice, we determine whether the null
hypothesis can be rejected using a significance test (also called statistical
hypothesis testing).
First, we calculate the test statistic. For the residual-based OLS-MOSUM
process, it is defined as:
\begin{equation} \label{eq:test_statistic}
  S_{\text{MOSUM}} = \max(\|\text{M(t)}\|) \quad \text{ for } t \text{ in } 1,2,..,(n - \floor{nh} + 1)
\end{equation}
where $\| . \|$ signifies the absolute value.\\\\
We use the value of $S_{\text{MOSUM}}$ to calculate the probability of getting such
sample, given that the null hypothesis holds, using the critical values approach.
We then compare the resulting
probability with a chosen confidence interval, which is typically some low value
of $\alpha = 0.05$ or $\alpha = 0.01$. If the resulting probability is below the
value of $\alpha$, we reject the null hypothesis. 
In our case, it would mean that a
structural change is detected in the time series. 


\section{Steps of the Algorithm}
We determine whether the structural changes are present in the time series by following these steps:
\label{sec:the_algorithm_steps}
\begin{enumerate}
\item \textbf{Find the value of $\hat{\beta}^{(n)}$ using OLS-based linear
  regression using the vectors of observations $x$ and $y$}
\item \textbf{Calculate the OLS residuals $\hat{\mu}$, using} (\ref{eq:residuals})
\item \textbf{Calculate the standard deviation $\hat{\sigma}$, using} (\ref{eq:sigma})
\item \textbf{Calculate the residual-based OLS-MOSUM process from} (\ref{eq:mosum}). \\
  We need to calculate the values of the $M(t)$ for all positive integer values of
  $t \leq (n - \floor{nh} + 1)$. Hence, we can use the cumulative sum to
  calculate the process by evaluating following
  (using zero-indexing):
  \begin{verbatim}
  nh = floor(n * h)
  e = concat([0], residuals)
  process = cumsum(e)
  process = process[nh:n] - process[0:(n - nh + 1)]
  process = process / (sigma * sqrt(n))
  \end{verbatim}
\item \textbf{Calculate the test statistic, using} (\ref{eq:test_statistic})
\item \textbf{Calculate the p-value}:\\
  The p-value is calculated from the table of
  simulated asymptotic critical values of the Moving Estimate (ME) tests with
  the maximum norm, given by Chu et al. \cite{moving_estimate_test}. The structure of the table can
  be seen in Table \ref{table:critvals} and there is a $4 \times 10$ table for
  each value of $n_{\text{dim}} \in \{1..6\}$, where $n_{\text{dim}}$ is the
  size of the vector $x_i$, without the added identity row, hence
  $n_{\text{dim}} = k - 1$. The columns in the table sections correspond to the
  tail probabilities $p \in \{0.10, 0.05, 0.025, 0.001\}$, while the rows
  correspond to the values of the bandwidth parameter
  $h \in \{0.05, 0.10, ..., 0.5\}$. The values in the table are the values of
  the test statistic $S_{\text{MOSUM}}$.

  We start by selecting the table section that corresponds to our value of
  $k-1$. Then we select the table row for our value of $h$.
  However, when the value of $h \notin \{0.05, 0.10, ..., 0.5\}$
  we use one-dimensional piecewise linear interpolation in order to get the four
  values of $S_{\text{MOSUM}}$ that correspond to the tail probabilities 
  $p \in \{0.1, 0.05, 0.025, 0.01\}$. 

  Finally, we apply the linear interpolation in order to caclulate the
  tail probability that corresponds to the value of the test statistic $(S_{\text{MOSUM}})$.
  This is our p-value.

  Consider this example. Let us assume that we are working with a time series,
  $x_i = (1, x_{i1})^T$, hence $n_{\text{dim}} = 1$ and we choose the first
  section of the table.
  Let the bandwidth parameter $h = 0.12$.
  This value is not present in the set $\{0.05, 0.10, ..., 0.5\}$. Therefore, we must perform a linear
  interpolation in order to obtain the four values of the test statistic that
  correspond to tail probabilities $\{0.1, 0.05, 0.025, 0.01\}$. We
  calculate following values: $\{1.03698, 1.11134, 1.18094, 1.26396\}$. Let the
  value of our statistic be $S_{\text{MOSUM}}=1.1914$. We notice that the value
  of $1.1914$ lies between the last two values that we have just
  calculated. In order to calculate the tail probability that corresponds to
  $1.1914$, we perform another linear interpolation and calculate the tail probability $p=0.023$.
\item \textbf{Return the result}: \\
  If $p \leq \alpha$, we reject the null-hypothesis. In other words, we detect
  structural change in the time-series, otherwise we do not.

  For the example from the previous step, assume the confidence interval $\alpha=0.05$. Then
  $p=0.023<\alpha$ and we must reject the null-hypothesis of no structural
  change.
\end{enumerate}

\begin{table}[]
\centering
\begin{tabular}{|l|l|l|l|l|l|}
\hline
\multirow{2}{*}{$n_{\text{dim}}$}        & \multicolumn{1}{c|}{\multirow{2}{*}{h}} & \multicolumn{4}{c|}{Tail probability}                                                                     \\ \cline{3-6} 
                          & \multicolumn{1}{c|}{}                   & 0.10                     & 0.05                     & 0.025                    & 0.01                     \\ \hline
\multirow{4}{*}{1}        & 0.05                                    & 0.7552                   & 0.8017                   & 0.8444                   & 0.8977                   \\ \cline{2-6} 
                          & 0.10                                    & 0.9809                   & 1.0483                   & 1.1119                   & 1.1888                   \\ \cline{2-6} 
                          & \multicolumn{1}{c|}{...}                & \multicolumn{1}{c|}{...} & \multicolumn{1}{c|}{...} & \multicolumn{1}{c|}{...} & \multicolumn{1}{c|}{...} \\ \cline{2-6} 
                          & 0.50                                    & 1.3560                   & 1.4938                   & 1.6166                   & 1.7663                   \\ \hline
\multirow{4}{*}{2}        & 0.05                                    & 0.7997                   & 0.8431                   & 0.8838                   & 0.9351                   \\ \cline{2-6} 
                          & 0.10                                    & 1.0448                   & 1.1067                   & 1.1634                   & 1.2388                   \\ \cline{2-6} 
                          & \multicolumn{1}{c|}{...}                & \multicolumn{1}{c|}{...} & \multicolumn{1}{c|}{...} & \multicolumn{1}{c|}{...} & \multicolumn{1}{c|}{...} \\ \cline{2-6} 
                          & 0.50                                    & 1.4884                   & 1.6125                   & 1.7266                   & 1.8639                   \\ \hline
\multicolumn{1}{|c|}{...} & \multicolumn{1}{c|}{...}                & \multicolumn{1}{c|}{...} & \multicolumn{1}{c|}{...} & \multicolumn{1}{c|}{...} & \multicolumn{1}{c|}{...} \\ \hline
\end{tabular}
\caption{An excerpt from the table of simulated asymptotic critical values of the
  ME tests with the maximum norm \cite{moving_estimate_test}.}
\label{table:critvals}
\end{table}

\section{Parameters and Their Values}
\label{sec:mosum_parameters}
The OLS-MOSUM test uses two parameters:
\begin{itemize}
\item The bandwidth parameter $h$. The BFAST R implementation
  \cite{bfast-github}, uses $0.15$.
\item Significance level $\alpha$. The BFAST implementation
  \cite{bfast-github}, uses a ubiquitous value of $0.05$
\end{itemize}


\biblio
\end{document}
